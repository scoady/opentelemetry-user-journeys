# ─────────────────────────────────────────────────────────────────────────────
# TechMart Helm values — kind / local-dev defaults
#
# Deploy with:
#   helm upgrade --install techmart ./infrastructure/helm/techmart \
#     --namespace webstore --create-namespace \
#     --values ./infrastructure/helm/techmart/values.yaml
# ─────────────────────────────────────────────────────────────────────────────

# ── PostgreSQL ────────────────────────────────────────────────────────────────
postgres:
  image:
    repository: postgres
    tag: "16-alpine"

  # Override password in production via --set or a separate secrets file.
  credentials:
    database: techmart
    user: techmart
    password: techmart-secret-pw

  storage: 1Gi

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# ── API ───────────────────────────────────────────────────────────────────────
api:
  image:
    repository: webstore/api
    tag: latest
    # Never — required for kind (images loaded via `kind load docker-image`).
    # Use IfNotPresent or Always when pulling from a real registry.
    pullPolicy: Never

  replicas: 2
  port: 3001

  otel:
    # Set to true to have the OTel Operator inject the Node.js SDK init container.
    # Requires the Instrumentation CR to exist in the namespace (setup-telemetry.sh).
    injectNodejs: true

  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"

# ── Frontend ──────────────────────────────────────────────────────────────────
frontend:
  image:
    repository: webstore/frontend
    tag: latest
    pullPolicy: Never

  replicas: 2

  ingress:
    enabled: true
    className: nginx
    # Leave host empty to match all incoming hostnames (default for kind / localhost).
    # Set to a real hostname for production, e.g. techmart.example.com
    host: ""

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# ── Inventory service ─────────────────────────────────────────────────────────
inventorySvc:
  image:
    repository: webstore/inventory-svc
    tag: latest
    pullPolicy: Never

  replicas: 1
  port: 3002

  # Simulated inventory DB latency in milliseconds.
  # Change live without redeploying:
  #   helm upgrade techmart ./infrastructure/helm/techmart \
  #     --namespace webstore --reuse-values \
  #     --set inventorySvc.artificialDelayMs=1500
  artificialDelayMs: 500

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "250m"

# ── Traffic generator (k6) ────────────────────────────────────────────────────
traffic:
  # Set to false to deploy without synthetic load (e.g. production).
  enabled: true

  # Requests per second. Adjust and run `helm upgrade` to change live.
  rps: 5

  # Target base URL. Override if deploying outside kind.
  targetUrl: "http://frontend.webstore.svc.cluster.local"

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "500m"
