{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus (Mimir)",
      "description": "Grafana Cloud Prometheus / Mimir",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    { "type": "grafana",    "id": "grafana",    "name": "Grafana",     "version": "10.0.0" },
    { "type": "datasource", "id": "prometheus", "name": "Prometheus",  "version": "1.0.0"  },
    { "type": "panel",      "id": "stat",       "name": "Stat",        "version": ""       },
    { "type": "panel",      "id": "gauge",      "name": "Gauge",       "version": ""       },
    { "type": "panel",      "id": "timeseries", "name": "Time series", "version": ""       }
  ],
  "title": "TechMart — CUJ SLO Dashboard",
  "description": "Burn rates, error budgets, and SLO health for all three Critical User Journeys: checkout (99.9% / p99<2s), product-discovery (99.9% / p99<1s), order-lookup (99.9% / p99<1s). Burn rate = (actual error rate) / (budget error rate). Fast burn >14.4x exhausts the monthly budget in ~2 days.",
  "uid": "techmart-cuj-slo",
  "version": 1,
  "schemaVersion": 38,
  "tags": ["slo", "techmart", "cuj", "burn-rate", "error-budget"],
  "time": { "from": "now-24h", "to": "now" },
  "refresh": "30s",
  "templating": {
    "list": [
      {
        "name": "datasource",
        "type": "datasource",
        "pluginId": "prometheus",
        "label": "Datasource",
        "hide": 0,
        "current": {}
      },
      {
        "name": "window",
        "type": "custom",
        "label": "SLO window",
        "query": "1h,6h,24h,7d,30d",
        "options": [
          { "text": "1h",  "value": "1h",  "selected": false },
          { "text": "6h",  "value": "6h",  "selected": false },
          { "text": "24h", "value": "24h", "selected": true  },
          { "text": "7d",  "value": "7d",  "selected": false },
          { "text": "30d", "value": "30d", "selected": false }
        ],
        "current": { "text": "24h", "value": "24h" },
        "hide": 0
      }
    ]
  },

  "panels": [

    {
      "type": "stat", "id": 1,
      "title": "Checkout — burn 1h",
      "description": "Error budget burn rate over 1h. 1× = on budget. >6× = slow burn (ticket). >14.4× = fast burn (page). At 14.4× the full 30-day budget is gone in ~2 days.",
      "gridPos": { "x": 0, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.checkout\", status_code=\"STATUS_CODE_ERROR\"}[1h])) / sum(rate(techmart_calls_total{span_name=\"cuj.checkout\"}[1h])) / 0.001",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "none", "orientation": "auto" },
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "displayName": "checkout 1h",
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1    },
            { "color": "orange", "value": 6    },
            { "color": "red",    "value": 14.4 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 2,
      "title": "product-discovery — burn 1h",
      "description": "Error budget burn rate over 1h for the product-discovery CUJ (GET /api/products). 1× = on budget. >14.4× = fast burn.",
      "gridPos": { "x": 4, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code=\"STATUS_CODE_ERROR\"}[1h])) / sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\"}[1h])) / 0.001",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "none" },
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1    },
            { "color": "orange", "value": 6    },
            { "color": "red",    "value": 14.4 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 3,
      "title": "order-lookup — burn 1h",
      "description": "Error budget burn rate over 1h for the order-lookup CUJ (GET /api/orders). 1× = on budget. >14.4× = fast burn.",
      "gridPos": { "x": 8, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code=\"STATUS_CODE_ERROR\"}[1h])) / sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\"}[1h])) / 0.001",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "none" },
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1    },
            { "color": "orange", "value": 6    },
            { "color": "red",    "value": 14.4 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 4,
      "title": "Checkout — burn 6h",
      "description": "Error budget burn rate over 6h. A slower window — sustained high values here alongside a high 1h rate confirm a real incident. >6× over 6h triggers the slow-burn alert.",
      "gridPos": { "x": 12, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.checkout\", status_code=\"STATUS_CODE_ERROR\"}[6h])) / sum(rate(techmart_calls_total{span_name=\"cuj.checkout\"}[6h])) / 0.001",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "none" },
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1    },
            { "color": "orange", "value": 6    },
            { "color": "red",    "value": 14.4 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 5,
      "title": "product-discovery — burn 6h",
      "description": "Error budget burn rate over 6h for the product-discovery CUJ.",
      "gridPos": { "x": 16, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code=\"STATUS_CODE_ERROR\"}[6h])) / sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\"}[6h])) / 0.001",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "none" },
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1    },
            { "color": "orange", "value": 6    },
            { "color": "red",    "value": 14.4 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 6,
      "title": "order-lookup — burn 6h",
      "description": "Error budget burn rate over 6h for the order-lookup CUJ.",
      "gridPos": { "x": 20, "y": 0, "w": 4, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code=\"STATUS_CODE_ERROR\"}[6h])) / sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\"}[6h])) / 0.001",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "none" },
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1    },
            { "color": "orange", "value": 6    },
            { "color": "red",    "value": 14.4 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 7,
      "title": "Checkout — success rate",
      "description": "% of cuj.checkout spans that did NOT end in STATUS_CODE_ERROR over the selected window. SLO target: ≥ 99.9%.",
      "gridPos": { "x": 0, "y": 5, "w": 8, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "100 * sum(increase(techmart_calls_total{span_name=\"cuj.checkout\", status_code!=\"STATUS_CODE_ERROR\"}[$window])) / sum(increase(techmart_calls_total{span_name=\"cuj.checkout\"}[$window]))",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "decimals": 3, "min": 99, "max": 100,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "red",    "value": null },
            { "color": "yellow", "value": 99.5 },
            { "color": "green",  "value": 99.9 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 8,
      "title": "product-discovery — success rate",
      "description": "% of cuj.product-discovery spans that did NOT end in STATUS_CODE_ERROR over the selected window. SLO target: ≥ 99.9%.",
      "gridPos": { "x": 8, "y": 5, "w": 8, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "100 * sum(increase(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code!=\"STATUS_CODE_ERROR\"}[$window])) / sum(increase(techmart_calls_total{span_name=\"cuj.product-discovery\"}[$window]))",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "decimals": 3, "min": 99, "max": 100,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "red",    "value": null },
            { "color": "yellow", "value": 99.5 },
            { "color": "green",  "value": 99.9 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 9,
      "title": "order-lookup — success rate",
      "description": "% of cuj.order-lookup spans that did NOT end in STATUS_CODE_ERROR over the selected window. SLO target: ≥ 99.9%.",
      "gridPos": { "x": 16, "y": 5, "w": 8, "h": 5 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "100 * sum(increase(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code!=\"STATUS_CODE_ERROR\"}[$window])) / sum(increase(techmart_calls_total{span_name=\"cuj.order-lookup\"}[$window]))",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "decimals": 3, "min": 99, "max": 100,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "red",    "value": null },
            { "color": "yellow", "value": 99.5 },
            { "color": "green",  "value": 99.9 }
          ]}
        }
      }
    },

    {
      "type": "gauge", "id": 10,
      "title": "Checkout — error budget remaining (30d)",
      "description": "How much of the 30-day error budget is left. Budget = 0.1% of checkout spans allowed to fail. Reaches 0% when the monthly allowance is fully consumed. SLO: 99.9%.",
      "gridPos": { "x": 0, "y": 10, "w": 8, "h": 7 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "100 * (1 - (sum(increase(techmart_calls_total{span_name=\"cuj.checkout\", status_code=\"STATUS_CODE_ERROR\"}[30d])) / sum(increase(techmart_calls_total{span_name=\"cuj.checkout\"}[30d]))) / 0.001)",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "showThresholdLabels": true, "showThresholdMarkers": true, "minVizHeight": 75 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "decimals": 1, "min": 0, "max": 100,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "red",    "value": null },
            { "color": "yellow", "value": 25   },
            { "color": "green",  "value": 50   }
          ]}
        }
      }
    },

    {
      "type": "gauge", "id": 11,
      "title": "product-discovery — error budget remaining (30d)",
      "description": "How much of the 30-day error budget is left for the product-discovery CUJ. Budget = 0.1% of requests. SLO: 99.9%.",
      "gridPos": { "x": 8, "y": 10, "w": 8, "h": 7 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "100 * (1 - (sum(increase(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code=\"STATUS_CODE_ERROR\"}[30d])) / sum(increase(techmart_calls_total{span_name=\"cuj.product-discovery\"}[30d]))) / 0.001)",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "showThresholdLabels": true, "showThresholdMarkers": true, "minVizHeight": 75 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "decimals": 1, "min": 0, "max": 100,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "red",    "value": null },
            { "color": "yellow", "value": 25   },
            { "color": "green",  "value": 50   }
          ]}
        }
      }
    },

    {
      "type": "gauge", "id": 12,
      "title": "order-lookup — error budget remaining (30d)",
      "description": "How much of the 30-day error budget is left for the order-lookup CUJ. Budget = 0.1% of requests. SLO: 99.9%.",
      "gridPos": { "x": 16, "y": 10, "w": 8, "h": 7 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "100 * (1 - (sum(increase(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code=\"STATUS_CODE_ERROR\"}[30d])) / sum(increase(techmart_calls_total{span_name=\"cuj.order-lookup\"}[30d]))) / 0.001)",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "showThresholdLabels": true, "showThresholdMarkers": true, "minVizHeight": 75 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "decimals": 1, "min": 0, "max": 100,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "red",    "value": null },
            { "color": "yellow", "value": 25   },
            { "color": "green",  "value": 50   }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 13,
      "title": "Checkout — p99 latency",
      "description": "99th percentile latency of the cuj.checkout span. SLO target: p99 < 2000 ms.",
      "gridPos": { "x": 0, "y": 17, "w": 8, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "histogram_quantile(0.99, sum(rate(techmart_duration_milliseconds_bucket{span_name=\"cuj.checkout\"}[5m])) by (le))",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "unit": "ms", "decimals": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 1000 },
            { "color": "red",    "value": 2000 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 14,
      "title": "product-discovery — p99 latency",
      "description": "99th percentile latency of the cuj.product-discovery span. SLO target: p99 < 1000 ms.",
      "gridPos": { "x": 8, "y": 17, "w": 8, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "histogram_quantile(0.99, sum(rate(techmart_duration_milliseconds_bucket{span_name=\"cuj.product-discovery\"}[5m])) by (le))",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "unit": "ms", "decimals": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 500  },
            { "color": "red",    "value": 1000 }
          ]}
        }
      }
    },

    {
      "type": "stat", "id": 15,
      "title": "order-lookup — p99 latency",
      "description": "99th percentile latency of the cuj.order-lookup span. SLO target: p99 < 1000 ms.",
      "gridPos": { "x": 16, "y": 17, "w": 8, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [{
        "expr": "histogram_quantile(0.99, sum(rate(techmart_duration_milliseconds_bucket{span_name=\"cuj.order-lookup\"}[5m])) by (le))",
        "legendFormat": ""
      }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "background", "graphMode": "area" },
      "fieldConfig": {
        "defaults": {
          "unit": "ms", "decimals": 0,
          "thresholds": { "mode": "absolute", "steps": [
            { "color": "green",  "value": null },
            { "color": "yellow", "value": 500  },
            { "color": "red",    "value": 1000 }
          ]}
        }
      }
    },

    {
      "type": "timeseries", "id": 20,
      "title": "Success Rate — all CUJs",
      "description": "Instantaneous success rate per CUJ (5m rate window). The dashed red line is the 99.9% SLO target. A CUJ dipping below this line is burning error budget.",
      "gridPos": { "x": 0, "y": 21, "w": 24, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [
        {
          "expr": "100 * sum(rate(techmart_calls_total{span_name=\"cuj.checkout\", status_code!=\"STATUS_CODE_ERROR\"}[5m])) / sum(rate(techmart_calls_total{span_name=\"cuj.checkout\"}[5m]))",
          "legendFormat": "checkout"
        },
        {
          "expr": "100 * sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code!=\"STATUS_CODE_ERROR\"}[5m])) / sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\"}[5m]))",
          "legendFormat": "product-discovery"
        },
        {
          "expr": "100 * sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code!=\"STATUS_CODE_ERROR\"}[5m])) / sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\"}[5m]))",
          "legendFormat": "order-lookup"
        },
        { "expr": "vector(99.9)", "legendFormat": "SLO target (99.9%)" }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent", "min": 98, "max": 100.5,
          "custom": { "lineWidth": 2, "fillOpacity": 5 }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "checkout" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "blue" } }]
          },
          {
            "matcher": { "id": "byName", "options": "product-discovery" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }]
          },
          {
            "matcher": { "id": "byName", "options": "order-lookup" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "purple" } }]
          },
          {
            "matcher": { "id": "byName", "options": "SLO target (99.9%)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },

    {
      "type": "timeseries", "id": 21,
      "title": "Burn Rate — 1h window",
      "description": "Error budget burn rate over a 1h window per CUJ. Dashed orange = 6× (slow-burn alert). Dashed red = 14.4× (fast-burn / page). At 14.4× the full 30-day budget is consumed in ~2 days; at 6× it's ~5 days.",
      "gridPos": { "x": 0, "y": 29, "w": 12, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [
        {
          "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.checkout\", status_code=\"STATUS_CODE_ERROR\"}[1h])) / sum(rate(techmart_calls_total{span_name=\"cuj.checkout\"}[1h])) / 0.001",
          "legendFormat": "checkout"
        },
        {
          "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code=\"STATUS_CODE_ERROR\"}[1h])) / sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\"}[1h])) / 0.001",
          "legendFormat": "product-discovery"
        },
        {
          "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code=\"STATUS_CODE_ERROR\"}[1h])) / sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\"}[1h])) / 0.001",
          "legendFormat": "order-lookup"
        },
        { "expr": "vector(14.4)", "legendFormat": "fast burn (14.4×)" },
        { "expr": "vector(6)",    "legendFormat": "slow burn (6×)"    }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "custom": { "lineWidth": 2, "fillOpacity": 5 }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "checkout" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "blue" } }]
          },
          {
            "matcher": { "id": "byName", "options": "product-discovery" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }]
          },
          {
            "matcher": { "id": "byName", "options": "order-lookup" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "purple" } }]
          },
          {
            "matcher": { "id": "byName", "options": "fast burn (14.4\u00d7)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "slow burn (6\u00d7)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "orange" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },

    {
      "type": "timeseries", "id": 22,
      "title": "Burn Rate — 6h window",
      "description": "Error budget burn rate over a 6h window per CUJ. A slower window reduces noise — use this alongside the 1h panel to distinguish a genuine incident from a brief spike. Same thresholds: 6× (slow) and 14.4× (fast).",
      "gridPos": { "x": 12, "y": 29, "w": 12, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [
        {
          "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.checkout\", status_code=\"STATUS_CODE_ERROR\"}[6h])) / sum(rate(techmart_calls_total{span_name=\"cuj.checkout\"}[6h])) / 0.001",
          "legendFormat": "checkout"
        },
        {
          "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\", status_code=\"STATUS_CODE_ERROR\"}[6h])) / sum(rate(techmart_calls_total{span_name=\"cuj.product-discovery\"}[6h])) / 0.001",
          "legendFormat": "product-discovery"
        },
        {
          "expr": "sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\", status_code=\"STATUS_CODE_ERROR\"}[6h])) / sum(rate(techmart_calls_total{span_name=\"cuj.order-lookup\"}[6h])) / 0.001",
          "legendFormat": "order-lookup"
        },
        { "expr": "vector(14.4)", "legendFormat": "fast burn (14.4×)" },
        { "expr": "vector(6)",    "legendFormat": "slow burn (6×)"    }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short", "decimals": 2, "min": 0,
          "custom": { "lineWidth": 2, "fillOpacity": 5 }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "checkout" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "blue" } }]
          },
          {
            "matcher": { "id": "byName", "options": "product-discovery" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }]
          },
          {
            "matcher": { "id": "byName", "options": "order-lookup" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "purple" } }]
          },
          {
            "matcher": { "id": "byName", "options": "fast burn (14.4\u00d7)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "slow burn (6\u00d7)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "orange" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    },

    {
      "type": "timeseries", "id": 23,
      "title": "p99 Latency — all CUJs",
      "description": "99th-percentile request latency per CUJ over a 5m rate window. Each CUJ has its own SLO: checkout < 2000 ms (red dashed), product-discovery and order-lookup < 1000 ms (orange dashed).",
      "gridPos": { "x": 0, "y": 37, "w": 24, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "${datasource}" },
      "targets": [
        {
          "expr": "histogram_quantile(0.99, sum(rate(techmart_duration_milliseconds_bucket{span_name=\"cuj.checkout\"}[5m])) by (le))",
          "legendFormat": "checkout"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(techmart_duration_milliseconds_bucket{span_name=\"cuj.product-discovery\"}[5m])) by (le))",
          "legendFormat": "product-discovery"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(techmart_duration_milliseconds_bucket{span_name=\"cuj.order-lookup\"}[5m])) by (le))",
          "legendFormat": "order-lookup"
        },
        { "expr": "vector(2000)", "legendFormat": "checkout SLO (2 s)"       },
        { "expr": "vector(1000)", "legendFormat": "browse / lookup SLO (1 s)" }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "custom": { "lineWidth": 2, "fillOpacity": 5 }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "checkout" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "blue" } }]
          },
          {
            "matcher": { "id": "byName", "options": "product-discovery" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "green" } }]
          },
          {
            "matcher": { "id": "byName", "options": "order-lookup" },
            "properties": [{ "id": "color", "value": { "mode": "fixed", "fixedColor": "purple" } }]
          },
          {
            "matcher": { "id": "byName", "options": "checkout SLO (2 s)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "red" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "browse / lookup SLO (1 s)" },
            "properties": [
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "orange" } },
              { "id": "custom.lineStyle", "value": { "fill": "dash" } },
              { "id": "custom.fillOpacity", "value": 0 },
              { "id": "custom.lineWidth", "value": 1 }
            ]
          }
        ]
      },
      "options": { "tooltip": { "mode": "multi" }, "legend": { "displayMode": "list", "placement": "bottom" } }
    }

  ]
}
